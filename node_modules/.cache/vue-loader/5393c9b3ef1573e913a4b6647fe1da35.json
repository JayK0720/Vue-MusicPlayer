{"remainingRequest":"/Users/jinkang/Desktop/Vue-MusicPlayer/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jinkang/Desktop/Vue-MusicPlayer/src/components/player/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jinkang/Desktop/Vue-MusicPlayer/src/components/player/index.vue","mtime":1572187666560},{"path":"/Users/jinkang/Desktop/Vue-MusicPlayer/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jinkang/Desktop/Vue-MusicPlayer/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/jinkang/Desktop/Vue-MusicPlayer/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jinkang/Desktop/Vue-MusicPlayer/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {mapGetters,mapMutations} from 'vuex'\nimport ProgressBar from '@/base/progress-bar'\nimport {playMode} from '@/common/js/config'\nimport {shuffle} from '@/common/js/util.js'\nimport Lyric from 'lyric-parser'\nimport {prefixStyle} from '@/common/js/dom'\nimport Scroll from '@/base/scroll'\nimport Loading from '@/base/loading'\nlet transform = prefixStyle('transform')\nlet transitionDuration = prefixStyle('transitionDuration');\nconst TIME = 250;\nconst HEIGHT = 32;\nexport default{\n\tname:'player',\n\tdata() {\n\t\treturn {\n\t\t\tflag:false,\n\t\t\tcurrentTime:0,\n\t\t\tcurrentLyric:null,\n\t\t\tcurrentPage:'cd',\n\t\t\tnumber:0\n\t\t}\n\t},\n\tcomponents:{ProgressBar,Scroll,Loading},\n\tcomputed:{\n\t\t...mapGetters([\n\t\t\t\t'fullScreen',\n\t\t\t\t'playList',\n\t\t\t\t'currentSong',\n\t\t\t\t'playing',\n\t\t\t\t'currentIndex',\n\t\t\t\t'mode',\n\t\t\t\t'sequenceList'\n\t\t\t]),\n\t\tcdClass(){\n\t\t\treturn this.playing? 'play' : 'pause'\n\t\t},\n\t\tpercent(){\n\t\t\treturn this.currentTime / this.currentSong.duration;\n\t\t},\n\t},\n\tcreated(){\n\t\tthis.touch = {}\n\t},\n\tmethods:{\n\t\t...mapMutations({\n\t\t\tfoldFullScreen:'SET_FULL_SCREEN',\n\t\t\tsetPlayingState:'SET_PLAYING',\n\t\t\tsetCurrentIndex:'SET_CURRENT_INDEX',\n\t\t\tsetPlayMode:'SET_MODE',\n\t\t\tsetPlayList:'SET_PLAY_LIST'\n\t\t}),\n\t\thandleFold(){\n\t\t\tthis.foldFullScreen(false);\n\t\t},\n\t\thandleTogglePlaying(){\n\t\t\tif(!this.flag) return;\n\t\t\t// playing 是getters里获取到的playing 状态, 点击播放按钮切换播放状态\n\t\t\tthis.setPlayingState(!this.playing);\n\t\t},\n\t\thandlePrev(){\n\t\t\t// 点击播放上一首\n\t\t\tif(!this.flag){\n\t\t\t\tthis.setPlayingState(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet index = this.currentIndex - 1;\n\t\t\tif(index === -1){\n\t\t\t\tindex = this.playList.length - 1;\n\t\t\t}\n\t\t\tthis.setCurrentIndex(index);\n\t\t\tthis.setPlayingState(true);\n\t\t\tthis.flag = false;\n\t\t},\n\t\thandleNext(){\n\t\t\tif(!this.flag) {\n\t\t\t\tthis.setPlayingState(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// 点击播放下一首,当index改变的时候,currentSong就会修改\n\t\t\tlet index = this.currentIndex + 1;\n\t\t\tif(index === this.playList.length){\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\tthis.setCurrentIndex(index);\n\t\t\tthis.setPlayingState(true);\n\t\t\tthis.flag = false;\n\t\t},\n\t\thandleSliderEnd(percent){\n\t\t\tlet currentTime = percent * this.currentSong.duration;\n\t\t\tthis.$refs.audio.currentTime = currentTime;\n\t\t\tif(!this.playing){\n\t\t\t\tthis.setPlayingState(true);\n\t\t\t}\n\t\t\tthis.number = 0;\n\t\t\tconst _this = this;\n\t\t\t(function skip(){\n\t\t\t\tif(currentTime*1000 > _this.currentLyric.lines[_this.number].time){\n\t\t\t\t\t_this.number++;\n\t\t\t\t\tskip();\n\t\t\t\t}\n\t\t\t})();\n\t\t},\n\t\tend(){\n\t\t\tif(this.mode === playMode.loop){\n\t\t\t\tthis.loop();\n\t\t\t}else{\n\t\t\t\tthis.handleNext();\n\t\t\t}\n\t\t},\n\t\tloop(){\n\t\t\tthis.$refs.audio.currentTime = 0;\n\t\t\tthis.$refs.audio.play();\n\t\t},\n\t\t/*\n\t\t在切换歌曲播放模式的时候,当前播放的歌曲在新的播放列表里的位置已经修改了，找到此时播放歌曲在新的播放列表里的位置,然后\n\t\t修改index.\n\t\t\n\t\ttodo:1\n\t\t1. 点击歌曲的时候，设置了当前的播放列表 playList 以及 sequenceList, currentIndex, currentSong 来自playList[currentIndex]\n\t\t2. 当切换播放模式为随机播放的时候, 修改了playList, 此时playList 和 循环列表播放的playList 不同\n\t\t3. 切换播放模式后，再次点击播放列表里的歌曲时,比如点击的为第1首歌曲,由于playList已经修改，此时的currentSong 和 渲染的播放列表歌曲不同。\n\t\t\n\t\ttodo:2 此时切换歌曲的时候,由于播放歌曲列表已经为顺序播放，此时点击 上一曲 或者 下一曲的时候, 又变成了顺序播放\n\t\t*/\n\t\thandleCheckPlayMode(){\n\t\t\tconst mode = (this.mode + 1)%3;\n\t\t\tthis.setPlayMode(mode);\n\t\t\tlet list = [];\n\t\t\tif(this.mode === playMode.random){\n\t\t\t\t/*\n\t\t\t\t传入this.sequenceList后，返回的list 为打乱后的数组，此时this.sequenceList本身也被修改了.\n\t\t\t\t当从随机模式切换为顺序播放或者单曲循环的时候,this.sequenceList还是为打乱后的列表而不是原始数据。\n\t\t\t\t所以在shuffle函数内部,不能直接修改this.sequenceList\n\t\t\t\t*/\n\t\t\t\tlist = shuffle(this.sequenceList);\n\t\t\t}else{\n\t\t\t\tlist = this.sequenceList;\n\t\t\t}\n\t\t\tthis.resetIndex(list);\n\t\t\tthis.setPlayList(list);\n\t\t},\n\t\tresetIndex(list){\n\t\t\tconst index = list.findIndex((item) => {\n\t\t\t\treturn item.songid === this.currentSong.songid;\n\t\t\t});\n\t\t\tthis.setCurrentIndex(index);\n\t\t},\n\t\tgetLyric(){\n\t\t\tthis.currentSong.getLyric().then(lyric => {\n\t\t\t\t// let currentLyric = this.formatLyric(lyric);\n\t\t\t\tthis.currentLyric = new Lyric(lyric);\n\t\t\t})\n\t\t},\n\t\tready(){\n\t\t\tthis.flag = true;\n\t\t},\n\t\terror(){\n\t\t\tthis.flag = true;\n\t\t},\n\t\ttimeupdate(e){\n\t\t\tthis.currentTime = e.target.currentTime;\n\t\t\tif(this.currentLyric){\n\t\t\t\tif(e.target.currentTime*1000 >= this.currentLyric.lines[this.number+1].time){\n\t\t\t\t\tthis.number++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(this.number > 6){\n\t\t\t\tlet offsetY = - HEIGHT * (this.number - 6);\n\t\t\t\tthis.$refs.lyricWrapper.style[transform] = `translate3d(0,${offsetY}px,0)`;\n\t\t\t\tthis.$refs.lyricWrapper.style[transitionDuration] = `${TIME}ms`;\n\t\t\t}\n\t\t\t\n\t\t},\n\t\tformat(interval){\n\t\t\tlet minute = Math.floor(interval / 60);\n\t\t\tlet second = this.padzero(interval % 60 | 0 );\n\t\t\treturn `${minute}:${second}`;\n\t\t},\n\t\tpadzero(num){\n\t\t\tlet length = num.toString().length;\n\t\t\treturn ('00' + num).substring(length);\n\t\t},\n\t\tformatLyric(lyric){\n\t\t\tlet arr = lyric.split('\\n');\n\t\t\tconst lyricArr = [];\n\t\t\tarr.forEach((item) => {\n\t\t\t\tlet temp = item.split(']');\n\t\t\t\tlet time = temp[0].slice(1);\n\t\t\t\tlet text = temp[1];\n\t\t\t\tlyricArr.push({\n\t\t\t\t\ttime:this.formatLyricTime(time),\n\t\t\t\t\ttext\n\t\t\t\t})\n\t\t\t})\n\t\t\treturn lyricArr\n\t\t},\n\t\thandleSlideStart(e){\n\t\t\tthis.touch.initial = true;\n\t\t\tthis.touch.startX = e.touches[0].pageX;\n\t\t\tthis.touch.startY = e.touches[0].pageY;\n\t\t},\n\t\thandleSlideMove(e){\n\t\t\tif(!this.touch.initial) return;\n\t\t\tlet delX = e.touches[0].pageX - this.touch.startX;\n\t\t\tlet delY = e.touches[0].pageY - this.touch.startY;\n\t\t\t/*\n\t\t\t如果当前页是歌词页面,且竖向滚动的距离大于横向滚动的距离时，此时不切换页面。\n\t\t\t*/\n\t\t\tif( Math.abs(delY) > Math.abs(delX) ) return;\n\t\t\tconst currentLeft = this.currentPage === 'cd' ? 0 : -window.innerWidth;\n\t\t\tlet offsetWidth = Math.min(0,Math.max(-window.innerWidth,currentLeft + delX));\n\t\t\tthis.touch.percent = Math.abs( offsetWidth / window.innerWidth );\n\t\t\tthis.$refs.lyric.style[transform] = `translate3d(${offsetWidth}px,0,0)`;\n\t\t\tthis.$refs.lyric.style[transitionDuration] = '0ms';\n\t\t},\n\t\thandleSlideEnd(){\n\t\t\t/*\n\t\t\t滑动结束的时候停在哪里？从右往左滑, 如果滑动的距离 大于 屏幕宽度的 30%，则直接显示歌词页面\n\t\t\t*/\n\t\t   let offsetWidth = 0;\n\t\t   if(this.currentPage === 'cd'){\n\t\t\t   if(this.touch.percent >= 0.3){\n\t\t\t\t   offsetWidth = -window.innerWidth;\n\t\t\t\t   this.currentPage = 'lyric'\n\t\t\t   }else{\n\t\t\t\t   offsetWidth = 0;\n\t\t\t   }\n\t\t   }else{\n\t\t\t   if(this.touch.percent <= 0.7){\n\t\t\t\t   offsetWidth = 0;\n\t\t\t\t   this.currentPage = 'cd';\n\t\t\t   }else{\n\t\t\t\t   offsetWidth = -window.innerWidth;\n\t\t\t   }\n\t\t   }\n\t\t   this.$refs.lyric.style[transform] = `translate3d(${offsetWidth}px,0,0)`;\n\t\t   this.$refs.lyric.style[transitionDuration] = `${TIME}ms`;\n\t\t}\n\t},\n\twatch:{\n\t\tcurrentSong(newSong,oldSong){\n\t\t\tif(newSong.songid === oldSong.songid) return;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.audio.play();\n\t\t\t\tthis.getLyric();\n\t\t\t}) \n\t\t},\n\t\tplaying(state){\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst audio = this.$refs.audio;\n\t\t\t\tstate ? audio.play() : audio.pause();\n\t\t\t})\n\t\t}\n\t}\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/player","sourcesContent":["<template>\n\t<div class=\"player\" v-show='playList.length > 0'>\n\t\t<transition name='slide'>\n\t\t\t<div class=\"full-screen-player\" v-show='fullScreen'>\n\t\t\t\t<div class=\"player-background\">\n\t\t\t\t\t<img v-bind:src=\"currentSong.image\" alt=\"\" width='100%' height='100%'>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"top\">\n\t\t\t\t\t<div class=\"arrow-down\" @touchstart.stop='handleFold'>\n\t\t\t\t\t\t<i class=\"iconfont\">&#xe721;</i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<h1 class=\"song-name\">{{currentSong.songname}}</h1>\n\t\t\t\t\t<div class=\"menu\">\n\t\t\t\t\t\t<i class=\"iconfont\">&#xe610;</i>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"middle\"\n\t\t\t\t\t@touchstart.prevent='handleSlideStart'\n\t\t\t\t\t@touchmove.prevent='handleSlideMove'\n\t\t\t\t\t@touchend='handleSlideEnd'\n\t\t\t\t>\n\t\t\t\t\t<div class=\"slide-left\">\n\t\t\t\t\t\t<div class=\"singer-name\">\n\t\t\t\t\t\t\t<p class='text'>{{currentSong.singer}}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"cd-wrapper\">\n\t\t\t\t\t\t\t<div class=\"cd\" :class='cdClass'>\n\t\t\t\t\t\t\t\t<img v-lazy=\"currentSong.image\" :alt=\"currentSong.songname\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"slide-right\" ref='lyric'>\n\t\t\t\t\t\t<template v-if='currentLyric'>\n\t\t\t\t\t\t\t<Scroll :data='currentLyric.lines'>\n\t\t\t\t\t\t\t\t<div class=\"lyric-wrapper\" ref='lyricWrapper'>\n\t\t\t\t\t\t\t\t\t<template v-if='currentLyric.lines.length'>\n\t\t\t\t\t\t\t\t\t\t<p\n\t\t\t\t\t\t\t\t\t\t\tv-for='(item,index) in currentLyric.lines'\n\t\t\t\t\t\t\t\t\t\t\tclass='lyric-text'\n\t\t\t\t\t\t\t\t\t\t\t:class='{active: number === index}'\n\t\t\t\t\t\t\t\t\t\t>{{item.txt}}</p>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t<p>暂无歌词</p>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Scroll>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<Loading v-show=\"(currentPage === 'lyric') && !currentLyric \"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bottom\">\n\t\t\t\t\t<div class=\"dot-wrapper\">\n\t\t\t\t\t\t<span class=\"dot\" :class=\"{active:currentPage === 'cd'}\"></span>\n\t\t\t\t\t\t<span class=\"dot\" :class=\"{active:currentPage === 'lyric'}\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"progress-wrap\">\n\t\t\t\t\t\t<span class=\"current time\">{{format(currentTime)}}</span>\n\t\t\t\t\t\t<div class=\"progress-bar\">\n\t\t\t\t\t\t\t<ProgressBar :percent='percent' @percentChange='handleSliderEnd'/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"total time\">{{format(currentSong.duration)}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"operator-wrap\">\n\t\t\t\t\t\t<div class=\"mode\" @click.prevent='handleCheckPlayMode'>\n\t\t\t\t\t\t\t<i class=\"iconfont\" v-if='mode===0'>&#xe674;</i>\n\t\t\t\t\t\t\t<i class=\"iconfont\" v-else-if='mode===1'>&#xe622;</i>\n\t\t\t\t\t\t\t<i class=\"iconfont\" v-else='mode===2'>&#xe612;</i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"prev\" @click='handlePrev'>\n\t\t\t\t\t\t\t<i class=\"iconfont\">&#xe602;</i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"play\" @click='handleTogglePlaying'>\n\t\t\t\t\t\t\t<template v-if='!playing'>\n\t\t\t\t\t\t\t\t<i class=\"iconfont\">&#xe652;</i>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<i class=\"iconfont\">&#xe603;</i>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"next\" @click='handleNext'>\n\t\t\t\t\t\t\t<i class=\"iconfont\">&#xe619;</i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"collect\">\n\t\t\t\t\t\t\t<i class=\"iconfont\">&#xe61a;</i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t\t<!-- <Audio :url='currentSong.url' ref='audio'/> -->\n\t\t<audio \n\t\t\tv-bind:src=\"currentSong.url\" \n\t\t\tref='audio'\n\t\t\t@canplay='ready'\n\t\t\t@error='error'\n\t\t\t@timeupdate='timeupdate'\n\t\t\t@ended='end'\n\t\t></audio>\n\t</div>\n</template>\n\n<script>\n\timport {mapGetters,mapMutations} from 'vuex'\n\timport ProgressBar from '@/base/progress-bar'\n\timport {playMode} from '@/common/js/config'\n\timport {shuffle} from '@/common/js/util.js'\n\timport Lyric from 'lyric-parser'\n\timport {prefixStyle} from '@/common/js/dom'\n\timport Scroll from '@/base/scroll'\n\timport Loading from '@/base/loading'\n\tlet transform = prefixStyle('transform')\n\tlet transitionDuration = prefixStyle('transitionDuration');\n\tconst TIME = 250;\n\tconst HEIGHT = 32;\n\texport default{\n\t\tname:'player',\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tflag:false,\n\t\t\t\tcurrentTime:0,\n\t\t\t\tcurrentLyric:null,\n\t\t\t\tcurrentPage:'cd',\n\t\t\t\tnumber:0\n\t\t\t}\n\t\t},\n\t\tcomponents:{ProgressBar,Scroll,Loading},\n\t\tcomputed:{\n\t\t\t...mapGetters([\n\t\t\t\t\t'fullScreen',\n\t\t\t\t\t'playList',\n\t\t\t\t\t'currentSong',\n\t\t\t\t\t'playing',\n\t\t\t\t\t'currentIndex',\n\t\t\t\t\t'mode',\n\t\t\t\t\t'sequenceList'\n\t\t\t\t]),\n\t\t\tcdClass(){\n\t\t\t\treturn this.playing? 'play' : 'pause'\n\t\t\t},\n\t\t\tpercent(){\n\t\t\t\treturn this.currentTime / this.currentSong.duration;\n\t\t\t},\n\t\t},\n\t\tcreated(){\n\t\t\tthis.touch = {}\n\t\t},\n\t\tmethods:{\n\t\t\t...mapMutations({\n\t\t\t\tfoldFullScreen:'SET_FULL_SCREEN',\n\t\t\t\tsetPlayingState:'SET_PLAYING',\n\t\t\t\tsetCurrentIndex:'SET_CURRENT_INDEX',\n\t\t\t\tsetPlayMode:'SET_MODE',\n\t\t\t\tsetPlayList:'SET_PLAY_LIST'\n\t\t\t}),\n\t\t\thandleFold(){\n\t\t\t\tthis.foldFullScreen(false);\n\t\t\t},\n\t\t\thandleTogglePlaying(){\n\t\t\t\tif(!this.flag) return;\n\t\t\t\t// playing 是getters里获取到的playing 状态, 点击播放按钮切换播放状态\n\t\t\t\tthis.setPlayingState(!this.playing);\n\t\t\t},\n\t\t\thandlePrev(){\n\t\t\t\t// 点击播放上一首\n\t\t\t\tif(!this.flag){\n\t\t\t\t\tthis.setPlayingState(false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet index = this.currentIndex - 1;\n\t\t\t\tif(index === -1){\n\t\t\t\t\tindex = this.playList.length - 1;\n\t\t\t\t}\n\t\t\t\tthis.setCurrentIndex(index);\n\t\t\t\tthis.setPlayingState(true);\n\t\t\t\tthis.flag = false;\n\t\t\t},\n\t\t\thandleNext(){\n\t\t\t\tif(!this.flag) {\n\t\t\t\t\tthis.setPlayingState(false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 点击播放下一首,当index改变的时候,currentSong就会修改\n\t\t\t\tlet index = this.currentIndex + 1;\n\t\t\t\tif(index === this.playList.length){\n\t\t\t\t\tindex = 0;\n\t\t\t\t}\n\t\t\t\tthis.setCurrentIndex(index);\n\t\t\t\tthis.setPlayingState(true);\n\t\t\t\tthis.flag = false;\n\t\t\t},\n\t\t\thandleSliderEnd(percent){\n\t\t\t\tlet currentTime = percent * this.currentSong.duration;\n\t\t\t\tthis.$refs.audio.currentTime = currentTime;\n\t\t\t\tif(!this.playing){\n\t\t\t\t\tthis.setPlayingState(true);\n\t\t\t\t}\n\t\t\t\tthis.number = 0;\n\t\t\t\tconst _this = this;\n\t\t\t\t(function skip(){\n\t\t\t\t\tif(currentTime*1000 > _this.currentLyric.lines[_this.number].time){\n\t\t\t\t\t\t_this.number++;\n\t\t\t\t\t\tskip();\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t},\n\t\t\tend(){\n\t\t\t\tif(this.mode === playMode.loop){\n\t\t\t\t\tthis.loop();\n\t\t\t\t}else{\n\t\t\t\t\tthis.handleNext();\n\t\t\t\t}\n\t\t\t},\n\t\t\tloop(){\n\t\t\t\tthis.$refs.audio.currentTime = 0;\n\t\t\t\tthis.$refs.audio.play();\n\t\t\t},\n\t\t\t/*\n\t\t\t在切换歌曲播放模式的时候,当前播放的歌曲在新的播放列表里的位置已经修改了，找到此时播放歌曲在新的播放列表里的位置,然后\n\t\t\t修改index.\n\t\t\t\n\t\t\ttodo:1\n\t\t\t1. 点击歌曲的时候，设置了当前的播放列表 playList 以及 sequenceList, currentIndex, currentSong 来自playList[currentIndex]\n\t\t\t2. 当切换播放模式为随机播放的时候, 修改了playList, 此时playList 和 循环列表播放的playList 不同\n\t\t\t3. 切换播放模式后，再次点击播放列表里的歌曲时,比如点击的为第1首歌曲,由于playList已经修改，此时的currentSong 和 渲染的播放列表歌曲不同。\n\t\t\t\n\t\t\ttodo:2 此时切换歌曲的时候,由于播放歌曲列表已经为顺序播放，此时点击 上一曲 或者 下一曲的时候, 又变成了顺序播放\n\t\t\t*/\n\t\t\thandleCheckPlayMode(){\n\t\t\t\tconst mode = (this.mode + 1)%3;\n\t\t\t\tthis.setPlayMode(mode);\n\t\t\t\tlet list = [];\n\t\t\t\tif(this.mode === playMode.random){\n\t\t\t\t\t/*\n\t\t\t\t\t传入this.sequenceList后，返回的list 为打乱后的数组，此时this.sequenceList本身也被修改了.\n\t\t\t\t\t当从随机模式切换为顺序播放或者单曲循环的时候,this.sequenceList还是为打乱后的列表而不是原始数据。\n\t\t\t\t\t所以在shuffle函数内部,不能直接修改this.sequenceList\n\t\t\t\t\t*/\n\t\t\t\t\tlist = shuffle(this.sequenceList);\n\t\t\t\t}else{\n\t\t\t\t\tlist = this.sequenceList;\n\t\t\t\t}\n\t\t\t\tthis.resetIndex(list);\n\t\t\t\tthis.setPlayList(list);\n\t\t\t},\n\t\t\tresetIndex(list){\n\t\t\t\tconst index = list.findIndex((item) => {\n\t\t\t\t\treturn item.songid === this.currentSong.songid;\n\t\t\t\t});\n\t\t\t\tthis.setCurrentIndex(index);\n\t\t\t},\n\t\t\tgetLyric(){\n\t\t\t\tthis.currentSong.getLyric().then(lyric => {\n\t\t\t\t\t// let currentLyric = this.formatLyric(lyric);\n\t\t\t\t\tthis.currentLyric = new Lyric(lyric);\n\t\t\t\t})\n\t\t\t},\n\t\t\tready(){\n\t\t\t\tthis.flag = true;\n\t\t\t},\n\t\t\terror(){\n\t\t\t\tthis.flag = true;\n\t\t\t},\n\t\t\ttimeupdate(e){\n\t\t\t\tthis.currentTime = e.target.currentTime;\n\t\t\t\tif(this.currentLyric){\n\t\t\t\t\tif(e.target.currentTime*1000 >= this.currentLyric.lines[this.number+1].time){\n\t\t\t\t\t\tthis.number++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(this.number > 6){\n\t\t\t\t\tlet offsetY = - HEIGHT * (this.number - 6);\n\t\t\t\t\tthis.$refs.lyricWrapper.style[transform] = `translate3d(0,${offsetY}px,0)`;\n\t\t\t\t\tthis.$refs.lyricWrapper.style[transitionDuration] = `${TIME}ms`;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\tformat(interval){\n\t\t\t\tlet minute = Math.floor(interval / 60);\n\t\t\t\tlet second = this.padzero(interval % 60 | 0 );\n\t\t\t\treturn `${minute}:${second}`;\n\t\t\t},\n\t\t\tpadzero(num){\n\t\t\t\tlet length = num.toString().length;\n\t\t\t\treturn ('00' + num).substring(length);\n\t\t\t},\n\t\t\tformatLyric(lyric){\n\t\t\t\tlet arr = lyric.split('\\n');\n\t\t\t\tconst lyricArr = [];\n\t\t\t\tarr.forEach((item) => {\n\t\t\t\t\tlet temp = item.split(']');\n\t\t\t\t\tlet time = temp[0].slice(1);\n\t\t\t\t\tlet text = temp[1];\n\t\t\t\t\tlyricArr.push({\n\t\t\t\t\t\ttime:this.formatLyricTime(time),\n\t\t\t\t\t\ttext\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\treturn lyricArr\n\t\t\t},\n\t\t\thandleSlideStart(e){\n\t\t\t\tthis.touch.initial = true;\n\t\t\t\tthis.touch.startX = e.touches[0].pageX;\n\t\t\t\tthis.touch.startY = e.touches[0].pageY;\n\t\t\t},\n\t\t\thandleSlideMove(e){\n\t\t\t\tif(!this.touch.initial) return;\n\t\t\t\tlet delX = e.touches[0].pageX - this.touch.startX;\n\t\t\t\tlet delY = e.touches[0].pageY - this.touch.startY;\n\t\t\t\t/*\n\t\t\t\t如果当前页是歌词页面,且竖向滚动的距离大于横向滚动的距离时，此时不切换页面。\n\t\t\t\t*/\n\t\t\t\tif( Math.abs(delY) > Math.abs(delX) ) return;\n\t\t\t\tconst currentLeft = this.currentPage === 'cd' ? 0 : -window.innerWidth;\n\t\t\t\tlet offsetWidth = Math.min(0,Math.max(-window.innerWidth,currentLeft + delX));\n\t\t\t\tthis.touch.percent = Math.abs( offsetWidth / window.innerWidth );\n\t\t\t\tthis.$refs.lyric.style[transform] = `translate3d(${offsetWidth}px,0,0)`;\n\t\t\t\tthis.$refs.lyric.style[transitionDuration] = '0ms';\n\t\t\t},\n\t\t\thandleSlideEnd(){\n\t\t\t\t/*\n\t\t\t\t滑动结束的时候停在哪里？从右往左滑, 如果滑动的距离 大于 屏幕宽度的 30%，则直接显示歌词页面\n\t\t\t\t*/\n\t\t\t   let offsetWidth = 0;\n\t\t\t   if(this.currentPage === 'cd'){\n\t\t\t\t   if(this.touch.percent >= 0.3){\n\t\t\t\t\t   offsetWidth = -window.innerWidth;\n\t\t\t\t\t   this.currentPage = 'lyric'\n\t\t\t\t   }else{\n\t\t\t\t\t   offsetWidth = 0;\n\t\t\t\t   }\n\t\t\t   }else{\n\t\t\t\t   if(this.touch.percent <= 0.7){\n\t\t\t\t\t   offsetWidth = 0;\n\t\t\t\t\t   this.currentPage = 'cd';\n\t\t\t\t   }else{\n\t\t\t\t\t   offsetWidth = -window.innerWidth;\n\t\t\t\t   }\n\t\t\t   }\n\t\t\t   this.$refs.lyric.style[transform] = `translate3d(${offsetWidth}px,0,0)`;\n\t\t\t   this.$refs.lyric.style[transitionDuration] = `${TIME}ms`;\n\t\t\t}\n\t\t},\n\t\twatch:{\n\t\t\tcurrentSong(newSong,oldSong){\n\t\t\t\tif(newSong.songid === oldSong.songid) return;\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.$refs.audio.play();\n\t\t\t\t\tthis.getLyric();\n\t\t\t\t}) \n\t\t\t},\n\t\t\tplaying(state){\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tconst audio = this.$refs.audio;\n\t\t\t\t\tstate ? audio.play() : audio.pause();\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang='scss' scoped>\n\t@import '@/common/scss/mixin.scss';\n\t.full-screen-player{\n\t\tposition:fixed;\n\t\tleft:0;\n\t\tbottom:0;\n\t\ttop:0;\n\t\tright:0;\n\t\tz-index:200;\n\t\tbackground-color:#232323;\n\t\tcolor:#ffffff;\n\t\t.player-background{\n\t\t\tposition:absolute;\n\t\t\tleft:0;\n\t\t\ttop:0;\n\t\t\twidth:100%;\n\t\t\theight:100%;\n\t\t\topacity:0.4;\n\t\t\tz-index:-1;\n\t\t\tfilter:blur(25px);\n\t\t}\n\t\t.top{\n\t\t\tmargin-top:30px;\n\t\t\tdisplay:flex;\n\t\t\tpadding:0 16px;\n\t\t\theight:20px;\n\t\t\tjustify-content:space-between;\n\t\t\talign-items:center;\n\t\t\t.arrow-down{\n\t\t\t\ttransform:rotateZ(-90deg);\n\t\t\t}\n\t\t\t.arrow-down,.menu{\n\t\t\t\tflex:0 0 20px;\n\t\t\t\t.iconfont{\n\t\t\t\t\tfont-size:20px;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.song-name{\n\t\t\t\ttext-align:center;\n\t\t\t}\n\t\t\t.song-name{\n\t\t\t\tflex:0 0 1;\n\t\t\t\theight:20px;\n\t\t\t\tline-height:20px;\n\t\t\t\tfont-size:18px;\n\t\t\t\t@include text-ellipsis;\n\t\t\t}\n\t\t}\n\t\t.middle{\n\t\t\tposition:fixed;\n\t\t\ttop:55px;\n\t\t\tbottom:135px;\n\t\t\twidth:100%;\n\t\t\twhite-space:nowrap;\n\t\t\toverflow:hidden;\n\t\t\t.singer-name{\n\t\t\t\tdisplay:flex;\n\t\t\t\tpadding:0 10px;\n\t\t\t\theight:44px;\n\t\t\t\tfont-size:14px;\n\t\t\t\tjustify-content:center;\n\t\t\t\talign-items:center;\n\t\t\t\tflex:1;\n\t\t\t\t.text{\n\t\t\t\t\tpadding:0 8px;\n\t\t\t\t\t@include text-ellipsis;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.singer-name:before,.singer-name:after{\n\t\t\t\tcontent:'';\n\t\t\t\tdisplay:block;\n\t\t\t\tflex:0 0 18px;\n\t\t\t\twidth:18px;\n\t\t\t\theight:1px;\n\t\t\t\tbackground-color:#ffffff;\n\t\t\t}\n\t\t\t.slide-left{\n\t\t\t\tdisplay:inline-block;\n\t\t\t\tposition:relative;\n\t\t\t\theight:100%;\n\t\t\t\twidth:100%;\n\t\t\t\tvertical-align:top;\n\t\t\t}\n\t\t\t.slide-right{\n\t\t\t\tdisplay:inline-block;\n\t\t\t\twidth:100%;\n\t\t\t\theight:100%;\n\t\t\t\t.wrapper{\n\t\t\t\t\theight:100%;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.lyric-wrapper{\n\t\t\t\twidth:100%;\n\t\t\t\ttext-align:center;\n\t\t\t\t.lyric-text{\n\t\t\t\t\tpadding:6px 0;\n\t\t\t\t\tfont-size:14px;\n\t\t\t\t\tcolor:#fff;\n\t\t\t\t\t&.active{\n\t\t\t\t\t\tcolor:#2fcb97;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t.cd-wrapper{\n\t\t\t\tposition:absolute;\n\t\t\t\ttop:50%;\n\t\t\t\tleft:50%;\n\t\t\t\ttransform:translate(-50%,-50%);\n\t\t\t\twidth:86%;\n\t\t\t\theight:0;\n\t\t\t\tpadding-top:86%;\n\t\t\t\tborder-radius:50%;\n\t\t\t\tborder:8px solid rgba(0,0,0,.3);\n\t\t\t\t.cd{\n\t\t\t\t\tposition:absolute;\n\t\t\t\t\tleft:0;\n\t\t\t\t\ttop:0;\n\t\t\t\t\twidth:100%;\n\t\t\t\t\theight:100%;\n\t\t\t\t\timg{\n\t\t\t\t\t\tdisplay:block;\n\t\t\t\t\t\twidth:100%;\n\t\t\t\t\t\theight:100%;\n\t\t\t\t\t\tborder-radius:50%;\n\t\t\t\t\t}\n\t\t\t\t\t&.play{\n\t\t\t\t\t\tanimation:rotate 20s linear infinite;\n\t\t\t\t\t\tanimation-play-state:run;\n\t\t\t\t\t}\n\t\t\t\t\t&.pause{\n\t\t\t\t\t\tanimation:rotate 20s linear infinite;\n\t\t\t\t\t\tanimation-play-state:paused;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t.bottom{\n\t\t\tposition:absolute;\n\t\t\tbottom:12px;\n\t\t\twidth:100%;\n\t\t\t.dot-wrapper{\n\t\t\t\theight:8px;\n\t\t\t\twidth:100%;\n\t\t\t\tfont-size:0;\n\t\t\t\ttext-align:center;\n\t\t\t\t.dot{\n\t\t\t\t\tdisplay:inline-block;\n\t\t\t\t\tmargin:0 4px;\n\t\t\t\t\twidth:8px;\n\t\t\t\t\theight:8px;\n\t\t\t\t\tbackground-color:#817d74;\n\t\t\t\t\tborder-radius:50%;\n\t\t\t\t\t&.active{\n\t\t\t\t\t\tbackground-color:#fff;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t.progress-wrap{\n\t\t\t\tdisplay:flex;\n\t\t\t\tmargin:0 auto;\n\t\t\t\theight:45px;\n\t\t\t\twidth:90%;\n\t\t\t\tline-height:45px;\n\t\t\t\talign-items:center;\n\t\t\t\t.time{\n\t\t\t\t\tflex:0 0 36px;\n\t\t\t\t\twidth:36px;\n\t\t\t\t\tcolor:#fff;\n\t\t\t\t\tfont-size:12px;\n\t\t\t\t}\n\t\t\t\t.current{\n\t\t\t\t\ttext-align:left;\n\t\t\t\t}\n\t\t\t\t.total{\n\t\t\t\t\ttext-align:right;\n\t\t\t\t}\n\t\t\t\t.progress-bar{\n\t\t\t\t\tflex:1;\n\t\t\t\t\theight:2px;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.operator-wrap{\n\t\t\t\tdisplay:flex;\n\t\t\t\theight:54px;\n\t\t\t\tcolor:#fff;\n\t\t\t\talign-items:center;\n\t\t\t\tjustify-content:space-around;\n\t\t\t\t.mode,.collect{\n\t\t\t\t\t.iconfont{\n\t\t\t\t\t\tfont-size:24px;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t.play{\n\t\t\t\t\t.iconfont{\n\t\t\t\t\t\tfont-size:40px;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t.prev,.next{\n\t\t\t\t\t.iconfont{\n\t\t\t\t\t\tfont-size:30px;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t.slide-enter-active,.slide-leave-active{\n\t\ttransition:all .3s;\n\t}\n\t.slide-enter,.slide-leave-to{\n\t\ttransform:translate3d(0,100%,0);\n\t}\n\t/*图片旋转动画*/\n\t@keyframes rotate{\n\t\t0%{\n\t\t\ttransform:rotateZ(0deg);\n\t\t}\n\t\t100%{\n\t\t\ttransform:rotateZ(360deg);\n\t\t}\n\t}\n</style>\n"]}]}